/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 */

// Copyright 2011-2014 Twitter, Inc.

!function(t){function s(){var t=document.createElement("smartbanner"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in s)if(void 0!==t.style[i])return{end:s[i]};return!1}var i=function(s){this.origHtmlMargin=parseFloat(t("html").css("margin-top")),this.options=t.extend({},t.smartbanner.defaults,s);var i=navigator.standalone,n=navigator.userAgent;if(this.options.force?this.type=this.options.force:null!=n.match(/iPhone|iPod/i)||n.match(/iPad/)&&this.options.iOSUniversalApp?null!=n.match(/Safari/i)&&(null!=n.match(/CriOS/i)||window.Number(n.substr(n.indexOf("OS ")+3,3).replace("_","."))<6)&&(this.type="ios"):n.match(/\bSilk\/(.*\bMobile Safari\b)?/)||n.match(/\bKF\w/)||n.match("Kindle Fire")?this.type="kindle":null!=n.match(/Android/i)?this.type="android":null!=n.match(/Windows NT 6.2/i)&&null!==n.match(/Touch/i)&&(this.type="windows"),this.type&&!i&&!this.getCookie("sb-closed")&&!this.getCookie("sb-installed")){this.scale="auto"==this.options.scale?t(window).width()/window.screen.width:this.options.scale,this.scale<1&&(this.scale=1);var e=t("android"==this.type?'meta[name="google-play-app"]':"ios"==this.type?'meta[name="apple-itunes-app"]':"kindle"==this.type?'meta[name="kindle-fire-app"]':'meta[name="msApplication-ID"]');0!=e.length&&("windows"==this.type?(this.pfn=t('meta[name="msApplication-PackageFamilyName"]').attr("content"),this.appId=e.attr("content")[1]):this.appId=/app-id=([^\s,]+)/.exec(e.attr("content"))[1],this.title=this.options.title?this.options.title:e.data("title")||t("title").text().replace(/\s*[|\-Â·].*$/,""),this.author=this.options.author?this.options.author:e.data("author")||(t('meta[name="author"]').length?t('meta[name="author"]').attr("content"):window.location.hostname),this.iconUrl=e.data("icon-url"),this.price=e.data("price"),this.create(),this.show(),this.listen())}};i.prototype={constructor:i,create:function(){var s,i=this.options.url?this.options.url:("windows"==this.type?"ms-windows-store:PDP?PFN="+this.pfn:"android"==this.type?"market://details?id=":"kindle"==this.type?"amzn://apps/android?asin=":"https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id")+this.appId,n=this.price||this.options.price,e=n?n+" - "+("android"==this.type?this.options.inGooglePlay:"kindle"==this.type?this.options.inAmazonAppStore:"ios"==this.type?this.options.inAppStore:this.options.inWindowsStore):"",a=null===this.options.iconGloss?"ios"==this.type:this.options.iconGloss;this.options.url?i=this.options.url:"android"==this.type?(i="market://details?id="+this.appId,this.options.GooglePlayParams&&(i=i+"&referrer="+this.options.GooglePlayParams)):i="https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id"+this.appId;var o='<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+e+'</span></div><a href="'+i+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>";this.options.layer?t(this.options.appendToSelector).append(o):t(this.options.appendToSelector).prepend(o),this.options.icon?s=this.options.icon:this.iconUrl?s=this.iconUrl:t('link[rel="apple-touch-icon-precomposed"]').length>0?(s=t('link[rel="apple-touch-icon-precomposed"]').attr("href"),null===this.options.iconGloss&&(a=!1)):t('link[rel="apple-touch-icon"]').length>0?s=t('link[rel="apple-touch-icon"]').attr("href"):t('meta[name="msApplication-TileImage"]').length>0?s=t('meta[name="msApplication-TileImage"]').attr("content"):t('meta[name="msapplication-TileImage"]').length>0&&(s=t('meta[name="msapplication-TileImage"]').attr("content")),s?(t("#smartbanner .sb-icon").css("background-image","url("+s+")"),a&&t("#smartbanner .sb-icon").addClass("gloss")):t("#smartbanner").addClass("no-icon"),this.bannerHeight=t("#smartbanner").outerHeight()+2,this.scale>1&&(t("#smartbanner").css("top",parseFloat(t("#smartbanner").css("top"))*this.scale).css("height",parseFloat(t("#smartbanner").css("height"))*this.scale).hide(),t("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",t(window).width()/this.scale)),t("#smartbanner").css("position",this.options.layer?"absolute":"static")},listen:function(){t("#smartbanner .sb-close").on("click",t.proxy(this.close,this)),t("#smartbanner .sb-button").on("click",t.proxy(this.install,this))},show:function(s){var i=t("#smartbanner");if(i.stop(),this.options.layer)i.animate({top:0,display:"block"},this.options.speedIn).addClass("shown").show(),t("html").animate({marginTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",s);else if(t.support.transition){i.animate({top:0},this.options.speedIn).addClass("shown");var n=function(){t("html").removeClass("sb-animation"),s&&s()};t("html").addClass("sb-animation").one(t.support.transition.end,n).emulateTransitionEnd(this.options.speedIn).css("margin-top",this.origHtmlMargin+this.bannerHeight*this.scale),t("#smartbanner").removeClass("smartbannerhide")}else i.slideDown(this.options.speedIn).addClass("shown")},hide:function(s){var i=t("#smartbanner");if(i.stop(),this.options.layer)i.animate({top:-1*this.bannerHeight*this.scale,display:"block"},this.options.speedIn).removeClass("shown"),t("html").animate({marginTop:this.origHtmlMargin},this.options.speedIn,"swing",s);else if(t.support.transition){i.css("top",-1*this.bannerHeight*this.scale).removeClass("shown");var n=function(){t("html").removeClass("sb-animation"),s&&s()};t("html").addClass("sb-animation").one(t.support.transition.end,n).emulateTransitionEnd(this.options.speedOut).css("margin-top",this.origHtmlMargin),t("#smartbanner").addClass("smartbannerhide")}else i.slideUp(this.options.speedOut).removeClass("shown")},close:function(t){t.preventDefault(),this.hide(),this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(t){this.options.hideOnInstall&&this.hide(),this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(t,s,i){var n=new Date;n.setDate(n.getDate()+i),s=encodeURI(s)+(null==i?"":"; expires="+n.toUTCString()),document.cookie=t+"="+s+"; path=/;"},getCookie:function(t){var s,i,n,e=document.cookie.split(";");for(s=0;s<e.length;s++)if(i=e[s].substr(0,e[s].indexOf("=")),n=e[s].substr(e[s].indexOf("=")+1),i=i.replace(/^\s+|\s+$/g,""),i==t)return decodeURI(n);return null},switchType:function(){var s=this;this.hide(function(){s.type="android"==s.type?"ios":"android";var i=t("android"==s.type?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");s.appId=/app-id=([^\s,]+)/.exec(i)[1],t("#smartbanner").detach(),s.create(),s.show()})}},t.smartbanner=function(s){var n=t(window),e=n.data("smartbanner"),a="object"==typeof s&&s;e||n.data("smartbanner",e=new i(a)),"string"==typeof s&&e[s]()},t.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",inAmazonAppStore:"In the Amazon Appstore",inWindowsStore:"In the Windows Store",GooglePlayParams:null,icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null,hideOnInstall:!0,layer:!1,iOSUniversalApp:!0,appendToSelector:"body"},t.smartbanner.Constructor=i,void 0===t.support.transition&&(t.fn.emulateTransitionEnd=function(s){var i=!1,n=this;t(this).one(t.support.transition.end,function(){i=!0});var e=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(e,s),this},t(function(){t.support.transition=s()}))}(window.jQuery);