define(["require","jquery","underscore","module/config"],function(require,$,_,config){var handle=function(action,data,$el){function getVisitorGroup(){var selectedGroup;if(ASSIGN_VISITOR_TO_GROUP&&(selectedGroup=read_cookie("visitorSplitGroup"),selectedGroup&&setVisitorGroup(selectedGroup)),!selectedGroup)for(var marker=100*Math.random(),percentCounter=0,i=1;MAX_GROUPS>=i;i++){var percent;try{percent=eval("GROUP_"+i+"_PERCENT")}catch(exception){break}if(percentCounter+=percent,percentCounter>marker){selectedGroup=i,ASSIGN_VISITOR_TO_GROUP&&setVisitorGroup(selectedGroup);break}}return selectedGroup}function setVisitorGroup(e){var o=window.location.host,r=o.split(".");if(r.length>1){var t=r.length;t>2&&(o=r[t-2]+"."+r[t-1])}var n="/",i=new Date(Date.now()+24*VISITOR_ASSIGNED_TO_GROUP_FOR_DAYS*60*60*1e3).toUTCString();document.cookie="visitorSplitGroup="+e+"; expires="+i+"; domain="+o+"; path="+n}function read_cookie(e){var o;return(o=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?o[1]:null}function insertTag(e,o){function r(){console.log("async_load"),t=document.createElement("script"),t.type="text/javascript",t.async=!0,"js"==e?t.src=o:"jsFunction"==e&&(t.innerHTML=o),i.parentNode.appendChild(t)}if(o&&e){(o.indexOf("conversion.js")>-1||o.indexOf("googleadservices.com")>-1)&&(o=buildGoogleSmartPixelImgUrl(),e="img");var t,n=document.getElementsByTagName("script"),i=n[n.length-1];"img"==e||"iframe"==e?(t=document.createElement(e),t.src=o,t.width=1,t.height=1,i.parentNode.appendChild(t)):("js"==e||"jsFunction"==e)&&r()}}function buildGoogleSmartPixelImgUrl(){var e="";if(google_conversion_id&&google_conversion_label&&(e="//www.googleadservices.com/pagead/conversion/"+google_conversion_id+"/?label="+google_conversion_label+"&guid=ON&script=0"),e.length>0&&google_custom_params){var o="";for(var r in google_custom_params)if(google_custom_params.hasOwnProperty(r)){var t="";void 0!==(t=google_custom_params[r])&&(Array.isArray(t)&&(t=t.toString().replace(/,/g,"%2C")),o=o+(o.length>0?"%3B":"")+r+"%3D"+encodeURIComponent(t))}}return o.length>0&&(e=e+"&data="+o),e}function testInsertAllTags(){var i,url,type;try{for(i=1;MAX_VENDORS>=i;i++)url=eval("VENDOR_"+i+"_TAG_URL"),type=eval("VENDOR_"+i+"_TAG_TYPE"),insertTag(type,url);console.log("VisitorSplit testing Success!")}catch(ex){console.log("VisitorSplit Error, params: ",i,url,type),alert(ex)}}function main(){console.groupCollapsed("ports.js::VisitorSplit");var selectedGroup=getVisitorGroup(),vendors,i,url,type;if(selectedGroup){console.log("selectedGroup",selectedGroup);try{if(vendors=eval("GROUP_"+selectedGroup+"_VENDORS")){for(console.log("vendors ",vendors,vendors.length),i=0;i<vendors.length;i++)url=eval("VENDOR_"+vendors[i]+"_TAG_URL"),type=eval("VENDOR_"+vendors[i]+"_TAG_TYPE"),insertTag(type,url),console.log("insertTag",url,type);console.log("VisitorSplit loading Success!")}else console.log("VisitorSplit Error: vendors is false")}catch(ex){console.log("VisitorSplit Error",ex),console.log("Params: ",i,url,type)}}console.groupEnd()}window.google_tag_params=data.tagParams||{},window.google_conversion_id=1001659580,window.google_conversion_label="nphXCKzK6wMQvLnQ3QM",window.google_custom_params=window.google_tag_params,window.google_remarketing_only=!0;var GROUP_1_VENDORS=[1],GROUP_1_PERCENT=33.33,GROUP_2_VENDORS=[2],GROUP_2_PERCENT=33.33,GROUP_3_VENDORS=[3],GROUP_3_PERCENT=33.33,MAX_GROUPS=3,MAX_VENDORS=3,VENDOR_1_TAG_URL="//static.criteo.net/js/ld/ld.js",VENDOR_1_TAG_TYPE="js",VENDOR_2_TAG_URL="//eu-sonar.sociomantic.com/js/2010-07-01/adpan/enter-ru",VENDOR_2_TAG_TYPE="js",VENDOR_3_TAG_URL="http://www.googleadservices.com/pagead/conversion.js",VENDOR_3_TAG_TYPE="js",ASSIGN_VISITOR_TO_GROUP=!0,VISITOR_ASSIGNED_TO_GROUP_FOR_DAYS=60;main()};return{handle:handle}});