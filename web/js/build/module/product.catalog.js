define(["jquery","underscore","mustache"],function(e,t){var a=e("body"),r=e(".js-productList-container"),o={},c=function(t){t.stopPropagation();var a=e(t.target),c=r.data("value"),n=a.attr("name");console.info("setFilter",a),a.is(":radio")?a.is(":checked")&&o[n]!==a[0]?(c[n]=a.val(),o[n]=a[0]):(delete c[n],a.removeAttr("checked"),o[n]=null):a.is(":checkbox")?a.is(":checked")?c[n]=a.val():delete c[n]:a.is(":text")&&(c[n]=a.val()),c.page=1,s(t,{clear:!0})},n=function(a){a.stopPropagation();var c=e(a.target),n=c.data("name"),i=r.data("value");if(console.info("deleteFilter",a,i,n),n){t.each(i,function(e,t){return t==n?(delete i[n],!0):void 0});var l=e(".js-productFilter-set").filter('[name="'+n+'"]');l.length&&(l.is(":radio")?(l.removeAttr("checked"),o[l.attr("name")]=null):l.is(":checkbox")?l.removeAttr("checked"):l.is(":text")&&(l.val(l.data("value")),l.trigger("change"))),i.page=1,s(a,{clear:!0}),a.preventDefault()}},i=function(a){a.stopPropagation();var c=r.data("value"),n=r.data("reset");console.info("clearFilter",a,c),n.sort=c.sort,r.data("value",t.extend({},n)),e(".js-productFilter-set").each(function(t,a){var r=e(a);r.is(":radio, :checkbox")?r.removeAttr("checked"):r.is(":text")&&(r.val(r.data("value")),r.trigger("change"))}),t.each(o,function(e,t){o[t]=null}),c.page=1,s(a,{clear:!0}),a.preventDefault()},l=function(a){a.stopPropagation();var o=e(a.target),c=o.data("value"),n=r.data("value");console.info("setSorting",o),t.isObject(c)&&(t.each(c,function(e,t){n[t]=e}),n.page=1,s(a,{clear:!0}),a.preventDefault())},d=function(e){e.stopPropagation(),console.info("loadMoreProducts",e),s(e,{clear:!1}),e.preventDefault()},s=function(o,c){var n=e(".js-productList-more"),i=r.data("url"),l=r.data("value");c=t.extend({clear:!1},c),console.info("loadProduct",n,r,l),i&&!0!==n.data("disabled")&&(e.get(i,l).done(function(e){t.isObject(e.result)&&l&&r.length&&(!0===c.clear&&r.empty(),l.page=e.result.page,l.count=e.result.count,l.count<=l.page*l.limit?n.hide():n.show(),t.each(e.result.productCards,function(e){r.append(e)}),t.isObject(e.result.widgets)&&(a.data("widget",e.result.widgets),a.trigger("render")))}).always(function(){n.data("disabled",!1)}),n.data("disabled",!0))};a.on("click dblclick",".js-productList-more",d).on("click",'input[type="radio"].js-productFilter-set',c).on("change",'input[type="checkbox"].js-productFilter-set',c).on("change",'input[type="text"].js-productFilter-set',c).on("click",".js-productFilter-delete",n).on("click",".js-productFilter-clear",i).on("click",".js-productFilter-sort",l)});