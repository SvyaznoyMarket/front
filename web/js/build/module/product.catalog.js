define(["jquery","underscore","mustache"],function(e,t){var a=e("body"),r=e(".js-productList-container"),c={},o=function(t){t.stopPropagation();var a=e(t.target),o=r.data("value"),i=a.attr("name");console.info("setFilter",a),a.is(":radio")?a.is(":checked")&&c[i]!==a[0]?(o[i]=a.val(),c[i]=a[0]):(delete o[i],a.removeAttr("checked"),c[i]=null):a.is(":checkbox")?a.is(":checked")?o[i]=a.val():delete o[i]:a.is(":text")&&(o[i]=a.val()),o.page=1,d({clear:!0})},i=function(a){a.stopPropagation();var o=e(a.target),i=o.data("name"),n=r.data("value");if(console.info("deleteFilter",a,n,i),i){t.each(n,function(e,t){return t==i?(delete n[i],!0):void 0});var l=e(".js-productFilter-set").filter('[name="'+i+'"]');l.length&&(l.is(":radio")?(l.removeAttr("checked"),c[l.attr("name")]=null):l.is(":checkbox")?l.removeAttr("checked"):l.is(":text")&&(l.val(l.data("value")),l.trigger("change"))),n.page=1,d({clear:!0}),a.preventDefault()}},n=function(a){a.stopPropagation();var o=r.data("value"),i=r.data("reset");console.info("clearFilter",a,o),i.sort=o.sort,r.data("value",t.extend({},i)),e(".js-productFilter-set").each(function(t,a){var r=e(a);r.is(":radio, :checkbox")?r.removeAttr("checked"):r.is(":text")&&(r.val(r.data("value")),r.trigger("change"))}),t.each(c,function(e,t){c[t]=null}),o.page=1,d({clear:!0}),a.preventDefault()},l=function(a){a.stopPropagation();var c=e(a.target),o=c.data("value"),i=r.data("value");console.info("setSorting",c),t.isObject(o)&&(t.each(o,function(e,t){i[t]=e}),i.page=1,d({clear:!0}),a.preventDefault())},s=function(e){e.stopPropagation(),console.info("loadMoreProducts",e),d({clear:!1}),e.preventDefault()},d=function(c){var o=e(".js-productList-more"),i=r.data("url"),n=r.data("value");c=t.extend({clear:!1},c),console.info("loadProduct",o,r,n),i&&!0!==o.data("disabled")&&(e.get(i,n).done(function(e){t.isObject(e.result)&&n&&r.length&&(!0===c.clear&&r.empty(),n.page=e.result.page,n.count=e.result.count,n.count<=n.page*n.limit?o.hide():o.show(),t.each(e.result.productCards,function(e){r.append(e)}),t.isObject(e.result.widgets)&&(a.data("widget",e.result.widgets),a.trigger("render")))}).always(function(){o.data("disabled",!1)}),o.data("disabled",!0))},u=function(){var t=r.data("value");e(".js-filter, .js-params").each(function(){e(":radio, :checkbox, :text",this).each(function(){var a=e(this),r=a.attr("name");a.is(":radio, :checkbox")?a.is(":checked")&&(t[r]=a.val()):a.is(":text")&&(t[r]=a.val())})}),t.page=1,d({clear:!0})};a.on("click dblclick",".js-productList-more",s).on("click",'input[type="radio"].js-productFilter-set',o).on("change",'input[type="checkbox"].js-productFilter-set',o).on("change",'input[type="text"].js-productFilter-set',o).on("click",".js-productFilter-delete",i).on("click",".js-productFilter-clear",n).on("click",".js-productFilter-sort",l),u()});