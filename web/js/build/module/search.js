define(["jquery","underscore","mustache","jquery.popup"],function(e,t,o){e(".js-search-form").on("submit",function(t){var o=e(e(t.target).data("inputSelector"));o.length&&o.val().length<2&&t.preventDefault()});var r=e("body"),s=e(".js-search-form"),c=e(".js-search-form-input"),a=e(".js-search-suggest"),n=e("#tpl-search-suggest").html(),i=e(".js-header"),u="search",l=function(e){i.addClass(u),c.trigger("focus"),e.preventDefault(),e.stopPropagation()},g=function(){var t=e(".js-search-form-input").val(),o="/search/autocomplete?q="+t;""!==t&&t.length>3&&e.ajax({type:"POST",url:o,success:f,error:v})},h=function(e){var t=e.target;s.is(t)||0!==s.has(t).length||(i.removeClass(u),c.val(""),a.hide().empty())},p=function(e){e.preventDefault(),c.val(""),c.trigger("focus"),a.hide().empty()},d=function(){a.addClass("m-body-loader")},f=function(){var r,s=500,c=function(r){console.log(r);var s,c={categories:{category:[]},products:{product:[]}};r.hasOwnProperty("categories")&&t.isArray(r.categories)&&r.categories.length&&(c.categories.category=r.categories,c.categories.hasCategories=!0),r.hasOwnProperty("products")&&t.isArray(r.products)&&r.products.length&&(c.products.product=r.products,c.products.hasProducts=!0),(r.categories.length>1||r.products.length>1)&&(s=o.render(n,{suggestData:c}),e("html,body").addClass("noScroll"),a.show().html(s))};return function(){var e=this,t=arguments;clearTimeout(r),r=setTimeout(function(){c.apply(e,t)},s)}}(),v=function(e,t,o){console.log(e),console.log(t),console.log(o)};r.on("click",".js-searchLink",l),r.on("keyup",".js-search-form-input",g),r.on("click",".js-search-input-clear",p),r.on("click",".js-suggest-link",d),r.on("click",function(){s.is(":visible")&&!a.is(":visible")&&(h(event),e("html,body").removeClass("noScroll"))}),r.on("touchmove",function(){a.is(":visible")?c.trigger("blur"):h(event)})});