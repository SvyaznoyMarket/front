define(["jquery","underscore","mustache","jquery.popup"],function(e,t,s){e(".js-search-form").on("submit",function(t){var s=e(e(t.target).data("inputSelector"));s.length&&s.val().length<2&&t.preventDefault()});var r=(e("html"),e("body")),o=e(".js-fader"),c=e(".js-search-form"),n=e(".js-search-form-input"),a=e(".js-search-suggest"),i=e("#tpl-search-suggest").html(),u="search",l=function(e){r.scrollTop(0),r.addClass(u),n.trigger("focus"),e.preventDefault(),e.stopPropagation()},g=function(){var t=e(".js-search-form-input").val(),s="/search/autocomplete?q="+t;""!==t&&t.length>3&&e.ajax({type:"POST",url:s,success:d,error:v})},p=function(e){var t=e.target;c.is(t)||0!==c.has(t).length||(r.removeClass(u),n.val(""),a.hide().empty())},h=function(e){e.preventDefault(),n.val(""),n.trigger("focus"),a.hide().empty()},f=function(){a.addClass("suggest-load"),a.hide().empty()},d=function(){var e,r=500,o=function(e){console.log(e);var r,o={categories:{category:[]},products:{product:[]}};e.hasOwnProperty("categories")&&t.isArray(e.categories)&&e.categories.length&&(o.categories.category=e.categories,o.categories.hasCategories=!0),e.hasOwnProperty("products")&&t.isArray(e.products)&&e.products.length&&(o.products.product=e.products,o.products.hasProducts=!0),(e.categories.length>1||e.products.length>1)&&(r=s.render(i,{suggestData:o}),a.show().html(r))};return function(){var t=this,s=arguments;clearTimeout(e),e=setTimeout(function(){o.apply(t,s)},r)}}(),v=function(e,t,s){console.log(e),console.log(t),console.log(s)};r.on("click",".js-searchLink",l),r.on("keyup",".js-search-form-input",g),r.on("click",".js-search-input-clear",h),r.on("click",".js-suggest-link",f),o.on("click",p),r.on("click",function(){c.is(":visible")&&!a.is(":visible")&&p(event)}),r.on("touchmove",function(){a.is(":visible")?n.trigger("blur"):p(event)})});