define(["jquery","underscore","mustache","jquery.popup"],function(e,t,s){e(".js-search-form").on("submit",function(t){var s=e(e(t.target).data("inputSelector"));s.length&&s.val().length<2&&t.preventDefault()});var o=(e("html"),e("body")),r=e(".js-fader"),c=e(".js-search-form"),n=e(".js-search-form-input"),a=e(".js-search-suggest"),i=e("#tpl-search-suggest").html(),u="search",l=function(e){o.scrollTop(0),o.addClass(u),n.trigger("focus"),e.preventDefault(),e.stopPropagation()},g=function(){var t=e(".js-search-form-input").val(),s="/search/autocomplete?q="+t;""!==t&&t.length>3&&e.ajax({type:"POST",url:s,success:d,error:v})},p=function(e){var t=e.target;c.is(t)||0!==c.has(t).length||(o.removeClass(u),n.val(""),a.hide().empty())},h=function(e){e.preventDefault(),n.val(""),n.trigger("focus"),a.hide().empty()},f=function(){a.addClass("suggest-load"),a.hide().empty()},d=function(){var e,o=500,r=function(e){console.log(e);var o,r={categories:{category:[]},products:{product:[]}};e.hasOwnProperty("categories")&&t.isArray(e.categories)&&e.categories.length&&(r.categories.category=e.categories,r.categories.hasCategories=!0),e.hasOwnProperty("products")&&t.isArray(e.products)&&e.products.length&&(r.products.product=e.products,r.products.hasProducts=!0),(e.categories.length>1||e.products.length>1)&&(o=s.render(i,{suggestData:r}),a.show().html(o))};return function(){var t=this,s=arguments;clearTimeout(e),e=setTimeout(function(){r.apply(t,s)},o)}}(),v=function(e,t,s){console.log(e),console.log(t),console.log(s)};o.on("click",".js-searchLink",l),o.on("keyup",".js-search-form-input",g),o.on("click",".js-search-input-clear",h),o.on("click",".js-suggest-link",f),r.on("click",p),o.on("click",function(){c.is(":visible")&&!a.is(":visible")&&p(event)}),o.on("touchmove",function(){a.is(":visible")?n.trigger("blur"):p(event)})});