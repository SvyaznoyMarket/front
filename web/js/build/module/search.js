define(["jquery","underscore","mustache","jquery.popup"],function(e,t,s){e(".js-search-form").on("submit",function(t){var s=e(e(t.target).data("inputSelector"));s.length&&s.val().length<2&&t.preventDefault()});var r=e("html"),o=e("body"),c=e(".js-search-form"),a=e(".js-search-form-input"),n=e(".js-search-suggest"),i=e("#tpl-search-suggest").html(),u=e(".js-header"),l="search",g="no-scroll",h=function(e){o.scrollTop(0),u.addClass(l),a.trigger("focus"),e.preventDefault(),e.stopPropagation()},p=function(){var t=e(".js-search-form-input").val(),s="/search/autocomplete?q="+t;""!==t&&t.length>3&&e.ajax({type:"POST",url:s,success:m,error:y})},d=function(e){var t=e.target;c.is(t)||0!==c.has(t).length||(u.removeClass(l),a.val(""),n.hide().empty())},f=function(e){e.preventDefault(),a.val(""),a.trigger("focus"),n.hide().empty()},v=function(){n.addClass("suggest-load"),n.hide().empty()},m=function(){var e,o=500,c=function(e){console.log(e);var o,c={categories:{category:[]},products:{product:[]}};e.hasOwnProperty("categories")&&t.isArray(e.categories)&&e.categories.length&&(c.categories.category=e.categories,c.categories.hasCategories=!0),e.hasOwnProperty("products")&&t.isArray(e.products)&&e.products.length&&(c.products.product=e.products,c.products.hasProducts=!0),(e.categories.length>1||e.products.length>1)&&(o=s.render(i,{suggestData:c}),r.addClass(g),n.show().html(o))};return function(){var t=this,s=arguments;clearTimeout(e),e=setTimeout(function(){c.apply(t,s)},o)}}(),y=function(e,t,s){console.log(e),console.log(t),console.log(s)};o.on("click",".js-searchLink",h),o.on("keyup",".js-search-form-input",p),o.on("click",".js-search-input-clear",f),o.on("click",".js-suggest-link",v),o.on("click",function(){c.is(":visible")&&!n.is(":visible")&&(d(event),r.removeClass(g))}),o.on("touchmove",function(){n.is(":visible")?a.trigger("blur"):d(event)})});