define(["jquery","mustache","module/config","module/util","jquery.popup","jquery.maskedinput"],function(t,e,o,s){var l=t("body"),n=t(".js-header"),r=n.css("position"),p="textfield-err",u='<div class="js-slotButton-popup popupBox popupBox-bid"><div class="popupBox_close js-slotButton-popup-close" style="display: block;"></div><div class="popupBox_inn"><form action="/orders/slot/create" method="post"><input type="hidden" name="productId" value="{{productId}}" /><input type="hidden" name="sender" value="{{sender}}" /><div class="popupBox_title">Отправить заявку</div><ul class="lst-tree"><li class="lst-tree__i lst-tree__i--tl">Закажите обратный звонок и уточните:</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> комплектность мебели и техники;</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> условия доставки, сборки и оплаты.</li></ul><div class="popupBox-bid__err js-slotButton-popup-errors" style="display: none;"></div><div class="orderU_fld js-slotButton-popup-element"><input class="orderU_tx textfield js-slotButton-popup-phone" type="tel" name="phone" value="{{userPhone}}" placeholder="8 (___) ___-__-__" data-mask="8 (xxx) xxx-xx-xx" /><label class="orderU_lbl orderU_lbl-str">Телефон</label><span class="js-slotButton-popup-element-error err-elem" style="display: none">Неверный формат телефона</span></div><div class="orderU_fld js-slotButton-popup-element"><input class="orderU_tx textfield js-slotButton-popup-email" type="text" name="email" value="{{userEmail}}" placeholder="mail@domain.com" /><label class="orderU_lbl">E-mail</label><span class="js-slotButton-popup-element-error err-elem" style="display: none">Неверный формат email</span></div><div class="orderU_fld"><label class="orderU_lbl">Имя</label><input class="orderU_tx textfield js-slotButton-popup-name" type="text" name="name" value="{{userName}}" /></div><div class="popupBox-bid__check js-slotButton-popup-element noselect"><input type="checkbox" class="customInput customInput-checkbox js-slotButton-popup-confirm" name="confirm" id="confirm" value="1" /> <label class="customLabel" for="confirm">Я ознакомлен и&nbsp;согласен <nobr>с&nbsp;информацией {{#partnerOfferUrl}}<a class="underline" href="{{partnerOfferUrl}}" target="_blank">{{/partnerOfferUrl}}о&nbsp;продавце и его офертой{{#partnerOfferUrl}}</a>{{/partnerOfferUrl}}</nobr></label></div><div class="popupBox-bid__vendor">Продавец-партнёр: {{partnerName}}</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-submitButton btn btn--big btn--slot noselect">Отправить заявку</button></div>{{#full}}<div class="popupBox-bid__footnote"><a href="{{productUrl}}" class="lnk--goto-card underline">Перейти в карточку товара</a></div>{{/full}}</form></div></div>',a='<div class="popupBox_title">Ваша заявка<br/>№ {{orderNumber}}<br/>отправлена</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-okButton btn btn--big btn--slot noselect">Ок</button></div>',i=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},c=function(t){var e=t.closest(".js-slotButton-popup-element");("checkbox"==t.attr("type")?e:t).addClass(p),e.find(".js-slotButton-popup-element-error").show()},d=function(t){var e=t.closest(".js-slotButton-popup-element");("checkbox"==t.attr("type")?e:t).removeClass(p),e.find(".js-slotButton-popup-element-error").hide()},f=function(e,o){var s=t(".js-slotButton-popup-phone",e);return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(s.val().replace(/\s+/g,""))?(d(s),!0):(o||c(s),!1)},m=function(e,o){var s=t(".js-slotButton-popup-email",e);return 0==s.val().length||i(s.val())?(d(s),!0):(o||c(s),!1)},b=function(e,o){var s=t(".js-slotButton-popup-confirm",e);return s[0].checked?(d(s),!0):(o||c(s),!1)},v=function(e){var o,s=!0;return f(e)||(s=!1,o||(o=t(".js-slotButton-popup-phone",e).closest(".js-slotButton-popup-element"))),m(e)||(s=!1,o||(o=t(".js-slotButton-popup-email",e).closest(".js-slotButton-popup-element"))),b(e)||(s=!1,o||(o=t(".js-slotButton-popup-confirm",e).closest(".js-slotButton-popup-element"))),{isValid:s,$errorInput:o}},B=function(t){for(var e in t)if(t.hasOwnProperty(e))return t[e]},_=function(e){t("html, body").animate({scrollTop:/^\d+$/.test(e)?e:e.offset().top},"fast")};l.on("click",".js-slotButton",function(o){function l(){h.hide(0,function(){h.remove()}),j.css({opacity:1,height:"auto",overflow:"visible"}),n.css("position",r),_(0)}o.preventDefault();var p=t(this),i=p.data("value"),c=B(i.product),d=t(".js-content"),j=t(".js-content-hidden"),h=t(e.render(u,{full:i.isFull,partnerName:c.partnerName,partnerOfferUrl:c.partnerOfferUrl,productUrl:c.url,productId:c.id,userPhone:"",userEmail:"",userName:""})),x=t(".js-slotButton-popup-close",h),y=t("form",h),k=t(".js-slotButton-popup-errors",y),U=t(".js-slotButton-popup-phone",y),g=t(".js-slotButton-popup-email",y),O=(t(".js-slotButton-popup-name",y),t(".js-slotButton-popup-confirm",y));_(0),d.append(h),h.show(),j.css({overflow:"hidden",opacity:0,height:0}),n.css("position","absolute"),x.click(function(t){t.preventDefault(),l()}),t.mask.definitions.x="[0-9]",t.mask.placeholder="_",t.mask.autoclear=!1,t.map(t("input",h),function(e){var o=t(e);"undefined"!=typeof o.data("mask")&&o.mask(o.data("mask"))}),U.blur(function(){f(y)}),U.keyup(function(){f(y,!0)}),g.blur(function(){m(y)}),g.keyup(function(){m(y,!0)}),O.click(function(){b(y,!0)}),y.submit(function(o){o.preventDefault(),k.empty().hide();var n=v(y);if(!n.isValid)return void _(n.$errorInput);var r=t(".js-slotButton-popup-submitButton",y);r.attr("disabled","disabled"),t.ajax({type:"POST",url:y.attr("action"),data:y.serializeArray(),success:function(n){return n.error?(k.text(n.error).show(),void _(k)):(y.after(t(e.render(a,{orderNumber:n.order.number}))),y.remove(),t(".js-slotButton-popup-okButton",h).click(function(){o.preventDefault(),l()}),_(0),void s.sendOrdersToGoogleAnalytics([n.order]))},error:function(){k.text("Ошибка при создании заявки").show(),_(k)},complete:function(){r.removeAttr("disabled")}})}),U.focus()})});