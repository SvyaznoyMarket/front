define(["jquery","mustache","module/config","jquery.popup","jquery.maskedinput"],function(e,t){var o=e("body"),r="textfield-err",l='<div class="js-slotButton-popup popupBox popupBox-bid" style="position: absolute; z-index: 1035;"><div class="popupBox_close js-slotButton-popup-close" style="display: block;"></div><div class="popupBox_inn"><form action="/orders/slot/create" method="post"><input type="hidden" name="productId" value="{{productId}}" /><input type="hidden" name="sender" value="{{sender}}" />{{#full}}<div class="popupBox_title">Отправить заявку</div><ul class="lst-tree"><li class="lst-tree__i lst-tree__i--tl">Закажите обратный звонок и уточните:</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> состав мебели и техники;</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> условия доставки, сборки и оплаты.</li></ul>{{/full}}{{^full}}<div class="popup--request__head">Отправить заявку</div>{{/full}}<div class="js-slotButton-popup-errors" style="display: none;"></div><div class="popup__form-group"><div class="orderU_fld"><input class="orderU_tx textfield" type="text" name="phone" value="{{userPhone}}" placeholder="8 (___) ___-__-__" data-mask="8 (xxx) xxx-xx-xx" /><label class="orderU_lbl orderU_lbl-str">Телефон</label></div></div><div class="popup__form-group"><div class="orderU_fld"><input class="orderU_tx textfield" type="text" name="email" value="{{userEmail}}" placeholder="mail@domain.com" /><label class="orderU_lbl">E-mail</label></div></div><div class="popup__form-group"><div class="orderU_fld"><label class="orderU_lbl">Имя</label><input class="orderU_tx textfield" type="text" name="name" value="{{userName}}" /></div></div><div class="popupBox-bid__check"><input type="checkbox" class="customInput customInput-checkbox" name="confirm" id="confirm" value="1" /> <label class="customLabel" for="confirm">Я ознакомлен и согласен с информацией о продавце и его {{#partnerOfferUrl}}<a class="underline" href="{{partnerOfferUrl}}" target="_blank">{{/partnerOfferUrl}}офертой{{#partnerOfferUrl}}</a>{{/partnerOfferUrl}}</label></div><div class="popupBox-bid__vendor">Продавец-партнёр: {{partnerName}}</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-submitButton btn6 popupBox-bid__btn">Отправить заявку</button></div>{{#full}}<div class="popupBox-bid__footnote"><a href="{{productUrl}}" class="lnk--goto-card js-slotButton-popup-close">Перейти в карточку товара</a></div>{{/full}}</form></div></div>',s='<div class="popupBox_title">Ваша заявка № {{orderNumber}} отправлена</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-okButton btn6 popupBox-bid__btn">Ок</button></div>',a=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},p=function(t){var o=!0,l=e('[name="phone"]',t),s=e('[name="email"]',t),p=".popup__form-group",i=".input-group";return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(l.val().replace(/\s+/g,""))?(l.removeClass(r).siblings(".js-slotButton-popup-error").hide(),l.parents(p).children(i).removeClass("lbl-error")):(o=!1,l.addClass(r).siblings(".js-slotButton-popup-error").show(),l.parents(p).children(i).addClass("lbl-error")),0==s.val().length||a(s.val())?(s.removeClass(r).siblings(".js-slotButton-popup-error").hide(),s.parents(p).children(i).removeClass("lbl-error")):(o=!1,s.addClass(r).siblings(".js-slotButton-popup-error").show(),s.parents(p).children(i).addClass("lbl-error")),o},i=function(e){for(var t in e)if(e.hasOwnProperty(t))return e[t]};o.on("click",".js-slotButton",function(o){o.preventDefault();var r=e(this),a=r.data("value"),n=i(a.product),u=e(".js-content"),d=e(".js-content-hidden"),c=e(t.render(l,{full:!0,partnerName:n.partnerName,partnerOfferUrl:n.partnerOfferUrl,productUrl:n.url,productId:n.id,userPhone:"",userEmail:"",userName:""})),f=e(".js-slotButton-popup-close",c),v=e("form",c),m=e(".js-slotButton-popup-errors",v);!function(){u.prepend(c),e("html, body").animate({scrollTop:0},"fast"),c.slideDown().show(0),d.css({overflow:"hidden"}).delay(100).animate({opacity:0,height:0}),f.click(function(e){e.preventDefault(),c.slideUp(400,function(){c.remove()}),d.css({opacity:1,height:"auto",overflow:"visible"})})}(),e.mask.definitions.x="[0-9]",e.mask.placeholder="_",e.mask.autoclear=!1,e.map(e("input",c),function(t){var o=e(t);"undefined"!=typeof o.data("mask")&&o.mask(o.data("mask"))}),e("input",c).blur(function(){p(v)}),e('[name="phone"]',c).keyup(function(t){var o=e(t.currentTarget).val();"_"!=o[o.length-1]&&p(v)}),v.submit(function(o){if(o.preventDefault(),p(v)){var r=e(".js-slotButton-popup-submitButton",v);r.attr("disabled","disabled"),e.ajax({type:"POST",url:v.attr("action"),data:v.serializeArray(),success:function(o){return o.error?void m.text(o.error).show():(v.after(e(t.render(s,{orderNumber:o.orderNumber}))),v.remove(),void e(".js-slotButton-popup-okButton",c).click(function(){c.trigger("close")}))},error:function(){m.text("Ошибка при создании заявки").show()},complete:function(){r.removeAttr("disabled")}})}})})});