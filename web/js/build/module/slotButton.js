define(["jquery","mustache","module/config","jquery.popup","jquery.maskedinput"],function(t,o){var e=t("body"),s=t(".js-header"),l="textfield-err",n='<div class="js-slotButton-popup popupBox popupBox-bid"><div class="popupBox_close js-slotButton-popup-close" style="display: block;"></div><div class="popupBox_inn"><form action="/orders/slot/create" method="post"><input type="hidden" name="productId" value="{{productId}}" /><input type="hidden" name="sender" value="{{sender}}" /><div class="popupBox_title">Отправить заявку</div><ul class="lst-tree"><li class="lst-tree__i lst-tree__i--tl">Закажите обратный звонок и уточните:</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> комплектность мебели и техники;</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> условия доставки, сборки и оплаты.</li></ul><div class="popupBox-bid__err js-slotButton-popup-errors" style="display: none;"></div><div class="orderU_fld js-slotButton-popup-element"><input class="orderU_tx textfield js-slotButton-popup-phone" type="tel" name="phone" value="{{userPhone}}" placeholder="8 (___) ___-__-__" data-mask="8 (xxx) xxx-xx-xx" /><label class="orderU_lbl orderU_lbl-str">Телефон</label><span class="js-slotButton-popup-element-error" style="display: none">Неверный формат телефона</span></div><div class="orderU_fld js-slotButton-popup-element"><input class="orderU_tx textfield js-slotButton-popup-email" type="text" name="email" value="{{userEmail}}" placeholder="mail@domain.com" /><label class="orderU_lbl">E-mail</label><span class="js-slotButton-popup-element-error" style="display: none">Неверный формат email</span></div><div class="orderU_fld"><label class="orderU_lbl">Имя</label><input class="orderU_tx textfield js-slotButton-popup-name" type="text" name="name" value="{{userName}}" /></div><div class="popupBox-bid__check js-slotButton-popup-element"><input type="checkbox" class="customInput customInput-checkbox js-slotButton-popup-confirm" name="confirm" id="confirm" value="1" /> <label class="customLabel" for="confirm">Я ознакомлен и&nbsp;согласен с информацией {{#partnerOfferUrl}}<a class="underline" href="{{partnerOfferUrl}}" target="_blank">{{/partnerOfferUrl}}о&nbsp;продавце и его офертой{{#partnerOfferUrl}}</a>{{/partnerOfferUrl}}</label></div><div class="popupBox-bid__vendor">Продавец-партнёр: {{partnerName}}</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-submitButton btn btn--big btn--slot noselect">Отправить заявку</button></div>{{#full}}<div class="popupBox-bid__footnote"><a href="{{productUrl}}" class="lnk--goto-card underline">Перейти в карточку товара</a></div>{{/full}}</form></div></div>',p='<div class="popupBox_title">Ваша заявка<br/>№ {{orderNumber}}<br/>отправлена</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-okButton btn btn--big btn--slot noselect">Ок</button></div>',r=function(t){var o=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return o.test(t)},u=function(t){var o=t.closest(".js-slotButton-popup-element");("checkbox"==t.attr("type")?o:t).addClass(l),o.find(".js-slotButton-popup-element-error").show()},a=function(t){var o=t.closest(".js-slotButton-popup-element");("checkbox"==t.attr("type")?o:t).removeClass(l),o.find(".js-slotButton-popup-element-error").hide()},i=function(o,e){var s=t(".js-slotButton-popup-phone",o);return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(s.val().replace(/\s+/g,""))?(a(s),!0):(e||u(s),!1)},c=function(o,e){var s=t(".js-slotButton-popup-email",o);return 0==s.val().length||r(s.val())?(a(s),!0):(e||u(s),!1)},d=function(o,e){var s=t(".js-slotButton-popup-confirm",o);return s[0].checked?(a(s),!0):(e||u(s),!1)},f=function(o){var e,s=!0;return i(o)||(s=!1,e||(e=t(".js-slotButton-popup-phone",o).closest(".js-slotButton-popup-element"))),c(o)||(s=!1,e||(e=t(".js-slotButton-popup-email",o).closest(".js-slotButton-popup-element"))),d(o)||(s=!1,e||(e=t(".js-slotButton-popup-confirm",o).closest(".js-slotButton-popup-element"))),{isValid:s,$errorInput:e}},m=function(t){for(var o in t)if(t.hasOwnProperty(o))return t[o]},v=function(o){t("html, body").animate({scrollTop:/^\d+$/.test(o)?o:o.offset().top-s.outerHeight()},"fast")};e.on("click",".js-slotButton",function(e){function l(){_.hide(0,function(){_.remove()}),B.css({opacity:1,height:"auto",overflow:"visible"})}e.preventDefault();var r=t(this),u=r.data("value"),a=m(u.product),b=t(".js-content"),B=t(".js-content-hidden"),_=t(o.render(n,{full:u.isFull,partnerName:a.partnerName,partnerOfferUrl:a.partnerOfferUrl,productUrl:a.url,productId:a.id,userPhone:"",userEmail:"",userName:""})),j=t(".js-slotButton-popup-close",_),h=t("form",_),x=t(".js-slotButton-popup-errors",h),y=t(".js-slotButton-popup-phone",h),k=t(".js-slotButton-popup-email",h),U=t(".js-slotButton-popup-name",h),g=t(".js-slotButton-popup-confirm",h);!function(){b.append(_),v(0),_.show(0),B.css({overflow:"hidden",opacity:0,height:0}),j.click(function(t){t.preventDefault(),l()})}(),t.mask.definitions.x="[0-9]",t.mask.placeholder="_",t.mask.autoclear=!1,t.map(t("input",_),function(o){var e=t(o);"undefined"!=typeof e.data("mask")&&e.mask(e.data("mask"))}),y.blur(function(){i(h)}),y.keyup(function(){i(h,!0)}),k.blur(function(){c(h)}),k.keyup(function(){c(h,!0)}),g.click(function(){d(h,!0)}),h.submit(function(e){e.preventDefault(),x.empty().hide();var s=f(h);if(!s.isValid)return void v(s.$errorInput);var n=t(".js-slotButton-popup-submitButton",h);n.attr("disabled","disabled"),t.ajax({type:"POST",url:h.attr("action"),data:h.serializeArray(),success:function(s){return s.error?(x.text(s.error).show(),void v(x)):(h.after(t(o.render(p,{orderNumber:s.orderNumber}))),h.remove(),t(".js-slotButton-popup-okButton",_).click(function(){e.preventDefault(),l(),v(0)}),void v(0))},error:function(){x.text("Ошибка при создании заявки").show(),v(x)},complete:function(){n.removeAttr("disabled")}})}),function(){var t=s.css("position");y.add(k).add(U).focus(function(){s.css("position","absolute")}),y.add(k).add(U).blur(function(){s.css("position",t)})}(),y.focus()})});