define(["jquery","mustache","module/config","jquery.popup","jquery.maskedinput"],function(e,r){var t=e("body"),o="textfield-err",s='<div class="js-slotButton-popup popup--request" style="position: absolute; z-index: 1035;"><a href="#" class="js-slotButton-popup-close popup--request__close" title="Закрыть">Закрыть</a><form action="/orders/slot/create" method="post"><input type="hidden" name="productId" value="{{productId}}" /><input type="hidden" name="sender" value="{{sender}}" />{{#full}}<div class="popup--request__head msg--recall">Закажите обратный звонок и уточните</div><ul class="recall-list"><li>Состав мебели и техники</li><li>Условия доставки, сборки и оплаты</li></ul>{{/full}}{{^full}}<div class="popup--request__head">Отправить заявку</div>{{/full}}<div class="js-slotButton-popup-errors" style="display: none;"></div><div class="popup__form-group"><div class="input-group"><label class="label-for-input label-phone">Телефон</label><input type="text" name="phone" value="{{userPhone}}" placeholder="8 (___) ___-__-__" data-mask="8 (xxx) xxx-xx-xx" /></div><span class="js-slotButton-popup-error popup__form-group__error" style="display: none">Неверный формат телефона</span></div><div class="popup__form-group"><div class="input-group"><label class="label-for-input">E-mail</label><input type="text" name="email" value="{{userEmail}}" placeholder="mail@domain.com" /></div><span class="js-slotButton-popup-error popup__form-group__error" style="display: none">Неверный формат email</span></div><div class="popup__form-group"><div class="input-group"><label class="label-for-input">Имя</label><input type="text" name="name" value="{{userName}}" /></div></div><div class="popup__form-group checkbox-group"><label><input type="checkbox" name="confirm" value="1" /><i></i> Я ознакомлен и согласен с информацией о продавце и его {{#partnerOfferUrl}}<a class="underline" href="{{partnerOfferUrl}}" target="_blank">{{/partnerOfferUrl}}офертой{{#partnerOfferUrl}}</a>{{/partnerOfferUrl}}</label></div><div class="popup__form-group vendor">Продавец-партнёр: {{partnerName}}</div><div class="btn--container"><button type="submit" class="js-slotButton-popup-submitButton btn btn--submit">Отправить заявку</button></div>{{#full}}<div class="popup__form-group msg--goto-card"><a href="{{productUrl}}" class="lnk--goto-card">Перейти в карточку товара</a></div>{{/full}}</form></div>',l='<div class="popup--request__head msg--send">Ваша заявка № {{orderNumber}} отправлена</div><div class="btn--container"><button type="submit" class="js-slotButton-popup-okButton btn btn--submit">Ок</button></div>',a=function(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)},p=function(r){var t=!0,s=e('[name="phone"]',r),l=e('[name="email"]',r),p=".popup__form-group",n=".input-group";return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(s.val().replace(/\s+/g,""))?(s.removeClass(o).siblings(".js-slotButton-popup-error").hide(),s.parents(p).children(n).removeClass("lbl-error")):(t=!1,s.addClass(o).siblings(".js-slotButton-popup-error").show(),s.parents(p).children(n).addClass("lbl-error")),0==l.val().length||a(l.val())?(l.removeClass(o).siblings(".js-slotButton-popup-error").hide(),l.parents(p).children(n).removeClass("lbl-error")):(t=!1,l.addClass(o).siblings(".js-slotButton-popup-error").show(),l.parents(p).children(n).addClass("lbl-error")),t},n=function(e){for(var r in e)if(e.hasOwnProperty(r))return e[r]};t.on("click",".js-slotButton",function(t){t.preventDefault();var o=e(this),a=o.data("value"),u=n(a.product),i=e(r.render(s,{full:!0,partnerName:u.partnerName,partnerOfferUrl:u.partnerOfferUrl,productUrl:u.url,productId:u.id,userPhone:"",userEmail:"",userName:""})),d=e("form",i),c=e(".js-slotButton-popup-errors",d);i.enterPopup({closeClick:!1,closeSelector:".js-slotButton-popup-close",destroyOnClose:!0}),e.mask.definitions.x="[0-9]",e.mask.placeholder="_",e.mask.autoclear=!1,e.map(e("input",i),function(r){var t=e(r);"undefined"!=typeof t.data("mask")&&t.mask(t.data("mask"))}),e("input",i).blur(function(){p(d)}),e('[name="phone"]',i).keyup(function(r){var t=e(r.currentTarget).val();"_"!=t[t.length-1]&&p(d)}),d.submit(function(t){if(t.preventDefault(),p(d)){var o=e(".js-slotButton-popup-submitButton",d);o.attr("disabled","disabled"),e.ajax({type:"POST",url:d.attr("action"),data:d.serializeArray(),success:function(t){return t.error?void c.text(t.error).show():(d.after(e(r.render(l,{orderNumber:t.orderNumber}))),d.remove(),void e(".js-slotButton-popup-okButton",i).click(function(){i.trigger("close")}))},error:function(){c.text("Ошибка при создании заявки").show()},complete:function(){o.removeAttr("disabled")}})}})})});