define(["jquery","mustache","module/config","jquery.popup","jquery.maskedinput"],function(e,t){var o=e("body"),r="textfield-err",l='<div class="js-slotButton-popup popupBox popupBox-bid"><div class="popupBox_close js-slotButton-popup-close" style="display: block;"></div><div class="popupBox_inn"><form action="/orders/slot/create" method="post"><input type="hidden" name="productId" value="{{productId}}" /><input type="hidden" name="sender" value="{{sender}}" /><div class="popupBox_title">Отправить заявку</div><ul class="lst-tree"><li class="lst-tree__i lst-tree__i--tl">Закажите обратный звонок и уточните:</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> состав мебели и техники;</li><li class="lst-tree__i"><i style="background-color: #c1d837" class="lst-tree__bul"></i> условия доставки, сборки и оплаты.</li></ul><div class="orderU_fld"><input class="orderU_tx textfield js-slotButton-popup-phone" type="text" name="phone" value="{{userPhone}}" placeholder="8 (___) ___-__-__" data-mask="8 (xxx) xxx-xx-xx" /><label class="orderU_lbl orderU_lbl-str">Телефон</label></div><div class="orderU_fld"><input class="orderU_tx textfield" type="text" name="email" value="{{userEmail}}" placeholder="mail@domain.com" /><label class="orderU_lbl">E-mail</label></div><div class="orderU_fld"><label class="orderU_lbl">Имя</label><input class="orderU_tx textfield" type="text" name="name" value="{{userName}}" /></div><div class="popupBox-bid__err js-slotButton-popup-errors" style="display: none;"></div><div class="popupBox-bid__check"><input type="checkbox" class="customInput customInput-checkbox" name="confirm" id="confirm" value="1" /> <label class="customLabel" for="confirm">Я ознакомлен и согласен с информацией о продавце и его {{#partnerOfferUrl}}<a class="underline" href="{{partnerOfferUrl}}" target="_blank">{{/partnerOfferUrl}}офертой{{#partnerOfferUrl}}</a>{{/partnerOfferUrl}}</label></div><div class="popupBox-bid__vendor">Продавец-партнёр: {{partnerName}}</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-submitButton btn6 popupBox-bid__btn">Отправить заявку</button></div>{{#full}}<div class="popupBox-bid__footnote"><a href="{{productUrl}}" class="lnk--goto-card underline">Перейти в карточку товара</a></div>{{/full}}</form></div></div>',s='<div class="popupBox_title">Ваша заявка № {{orderNumber}} отправлена</div><div class="popupBox-bid__footnote"><button type="submit" class="js-slotButton-popup-okButton btn6 popupBox-bid__btn">Ок</button></div>',a=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},n=function(t){var o=!0,l=e('[name="phone"]',t),s=e('[name="email"]',t),n=".orderU_fld",p=".input-group";return/8\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(l.val().replace(/\s+/g,""))?(l.removeClass(r).siblings(".js-slotButton-popup-error").hide(),l.parents(n).children(p).removeClass("lbl-error")):(o=!1,l.addClass(r).siblings(".js-slotButton-popup-error").show(),l.parents(n).children(p).addClass("lbl-error")),0==s.val().length||a(s.val())?(s.removeClass(r).siblings(".js-slotButton-popup-error").hide(),s.parents(n).children(p).removeClass("lbl-error")):(o=!1,s.addClass(r).siblings(".js-slotButton-popup-error").show(),s.parents(n).children(p).addClass("lbl-error")),o},p=function(e){for(var t in e)if(e.hasOwnProperty(t))return e[t]};o.on("click",".js-slotButton",function(o){function r(){f.hide(0,function(){f.remove()}),c.css({opacity:1,height:"auto",overflow:"visible"})}o.preventDefault();var a=e(this),i=a.data("value"),u=p(i.product),d=e(".js-content"),c=e(".js-content-hidden"),f=e(t.render(l,{full:i.isFull,partnerName:u.partnerName,partnerOfferUrl:u.partnerOfferUrl,productUrl:u.url,productId:u.id,userPhone:"",userEmail:"",userName:""})),v=e(".js-slotButton-popup-close",f),b=e("form",f),m=e(".js-slotButton-popup-errors",b),_=e(".js-slotButton-popup-phone",b);!function(){d.append(f),e("html, body").animate({scrollTop:0},"fast"),f.show(0),c.css({overflow:"hidden",opacity:0,height:0}),v.click(function(e){e.preventDefault(),r()})}(),e.mask.definitions.x="[0-9]",e.mask.placeholder="_",e.mask.autoclear=!1,e.map(e("input",f),function(t){var o=e(t);"undefined"!=typeof o.data("mask")&&o.mask(o.data("mask"))}),e("input",f).blur(function(){n(b)}),_.keyup(function(t){var o=e(t.currentTarget).val();"_"!=o[o.length-1]&&n(b)}),b.submit(function(o){if(o.preventDefault(),n(b)){var l=e(".js-slotButton-popup-submitButton",b);l.attr("disabled","disabled"),e.ajax({type:"POST",url:b.attr("action"),data:b.serializeArray(),success:function(l){return l.error?void m.text(l.error).show():(b.after(e(t.render(s,{orderNumber:l.orderNumber}))),b.remove(),void e(".js-slotButton-popup-okButton",f).click(function(){o.preventDefault(),r()}))},error:function(){m.text("Ошибка при создании заявки").show()},complete:function(){l.removeAttr("disabled")}})}}),_.focus()})});