define(["jquery","mustache","module/config","module/util","jquery.popup","jquery.maskedinput"],function(t,o,e,n){var r=t("body"),s=t(".js-header"),u=s.css("position"),p="error",l=function(t){var o=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return o.test(t)},a=function(o){var e=t(".js-slotButton-popup-element");("checkbox"==o.attr("type")?e:o).addClass(p),e.parent().find(".js-slotButton-popup-element-error").show()},i=function(o){var e=t(".js-slotButton-popup-element");("checkbox"==o.attr("type")?e:o).removeClass(p),e.parent().find(".js-slotButton-popup-element-error").hide()},c=function(o,e){var n=t(".js-slotButton-popup-phone",o);return/\+7\(\d{3}\)\d{3}-\d{2}-\d{2}/.test(n.val().replace(/\s+/g,""))?(i(n),!0):(e||a(n),!1)},f=function(o,e){var n=t(".js-slotButton-popup-email",o);return 0==n.val().length||l(n.val())?(i(n),!0):(e||a(n),!1)},d=function(o,e){var n=t(".js-slotButton-popup-confirm",o);return n[0].checked?(i(n),!0):(e||a(n),!1)},m=function(o){var e,n=!0;return c(o)||(n=!1,e||(e=t(".js-slotButton-popup-phone",o).closest(".js-slotButton-popup-element"))),f(o)||(n=!1,e||(e=t(".js-slotButton-popup-email",o).closest(".js-slotButton-popup-element"))),d(o)||(n=!1,e||(e=t(".js-slotButton-popup-confirm",o).closest(".js-slotButton-popup-element"))),{isValid:n,$errorInput:e}},v=function(t){for(var o in t)if(t.hasOwnProperty(o))return t[o]},h=function(o){t("html, body").animate({scrollTop:/^\d+$/.test(o)?o:o.offset().top},"fast")};r.on("click",".js-slotButton",function(e){function r(){B.hide(0,function(){B.remove()}),j.css({opacity:1,height:"auto",overflow:"visible"}),t(".top-banner").css("position",u),s.css("position",u),h(0)}e.preventDefault();var p=t(this),l=p.data("value"),a=v(l.product),i=t(".js-content"),j=t(".js-content-hidden"),B=t(o.render(t("#tpl-cart-slot-form").html(),{full:l.isFull,partnerName:a.partnerName,partnerOfferUrl:a.partnerOfferUrl,productUrl:a.url,productId:a.id,userPhone:"",userEmail:"",userName:""})),b=t(".js-slotButton-popup-close",B),k=t("form",B),y=t(".js-slotButton-popup-errors",k),w=t(".js-slotButton-popup-phone",k),g=t(".js-slotButton-popup-email",k),x=(t(".js-slotButton-popup-name",k),t(".js-slotButton-popup-confirm",k));h(0),i.append(B),B.show(),j.css({overflow:"hidden",opacity:0,height:0}),t(".top-banner").css("position","absolute"),s.css("position","absolute"),b.click(function(t){t.preventDefault(),r()}),t.mask.definitions.x="[0-9]",t.mask.placeholder="_",t.mask.autoclear=!1,t.map(t("input",B),function(o){var e=t(o);"undefined"!=typeof e.data("mask")&&e.mask(e.data("mask"))}),w.blur(function(){c(k)}),w.keyup(function(){c(k,!0)}),g.blur(function(){f(k)}),g.keyup(function(){f(k,!0)}),x.click(function(){d(k,!0)}),k.submit(function(e){e.preventDefault(),y.empty().hide();var s=m(k);if(!s.isValid)return void h(s.$errorInput);var u=t(".js-slotButton-popup-submitButton",k);u.attr("disabled","disabled"),t.ajax({type:"POST",url:k.attr("action"),data:k.serializeArray(),success:function(s){return s.error?(y.text(s.error).show(),void h(y)):(k.after(t(o.render(t("#tpl-cart-slot-form-result").html(),{orderNumber:s.order.number}))),k.remove(),t(".js-slotButton-popup-okButton",B).click(function(){e.preventDefault(),r()}),h(0),void n.sendOrdersToGoogleAnalytics([s.order]))},error:function(){y.text("Ошибка при создании заявки").show(),h(y)},complete:function(){u.removeAttr("disabled")}})}),w.focus()})});