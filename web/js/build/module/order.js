<<<<<<< HEAD
define(["require","jquery","underscore","mustache","module/util","jquery.maskedinput","module/order/user.form","module/order/common","module/order/toggle"],function(e,o,t,n){var a=o("body"),r=o(".js-order-delivery-form"),i=o("#yandexMap"),d=o("#yandexMap-container"),l=o("#tpl-order-delivery-marker-balloon"),p=o("#tpl-order-delivery-point-popup"),p=o("#tpl-order-delivery-point-popup-list"),s=o("#tpl-order-delivery-calendar"),c=o("#tpl-order-delivery-address-popup"),m=o("#tpl-modalWindow"),u=o("#tpl-order-delivery-discount-popup"),f=function(e){e.geoObjects.events.remove("click"),e.geoObjects.events.add("click",function(o){var t=o.get("target");console.info("placemark",t,t.properties.get("point")),e.balloon.open(o.get("coords"),n.render(l.html(),t.properties.get("point")))})},v=function(e){e.stopPropagation();var t=o(e.currentTarget);t.data("value")&&o.ajax({url:r.attr("action"),data:t.data("value"),type:"post",timeout:3e4}).done(function(e){o(r.data("containerSelector")).html(e)}).always(function(){console.info("unblock screen")}),e.preventDefault()},h=function(e){var t=o(".js-delivery-type").data("data-selector"),a=o.parseJSON(o(t).html()),r=a.points,i={};i.points=[];for(var d=0;d<e.length;d++)for(var l=0;l<r.length;l++)(e[d]==r[l].group.value||e[d]==r[l].cost.name||e[d]==r[l].date.value)&&i.points.push(r[l]);o(".js-order-points-container-type-points").html(n.render(p.data("partial")["page/order/delivery/point-list"].html(),i)),console.log(i),console.log(a)},g=function(e){e.stopPropagation();var t=o(".js-order-delivery-points-filter-params-list"),n=t.find("input"),a=[];n.each(function(){1==o(this).prop("checked")&&a.push(this.value)}),h(a),console.log(a)},y=function(t){t.stopPropagation();var r=o(this),l=o.parseJSON(o(r.data("dataSelector")).html()),s=o(m.html()).appendTo(a),c=r.data("modal-title"),u=r.data("modal-position");s.find(".js-modal-title").text(c),s.addClass(u),s.lightbox_me({onLoad:function(){s.find(".js-modal-content").append(n.render(p.html(),l,p.data("partial"))),a.css({overflow:"hidden"})},beforeClose:function(){d.append(i),a.css({overflow:"auto"})},centered:!1}),t.preventDefault(),setTimeout(function(){e(["module/yandexmaps"],function(){})},2500)},j=function(){var e=o(this),t=o(m.html()).appendTo(a),r=e.data("modal-title"),i=e.data("modal-position"),d={};t.find(".js-modal-title").text(r),t.addClass(i),t.lightbox_me({onLoad:function(){t.find(".js-modal-content").append(n.render(c.html(),d))},modalCSS:{top:"60px"}})},k=function(e){e.stopPropagation();var t=o(this),r=o.parseJSON(o(t.data("dataSelector")).html()),i=o(m.html()).appendTo(a),d=t.data("modal-title"),l=t.data("modal-position");i.find(".js-modal-title").text(d),i.addClass(l),i.lightbox_me({onLoad:function(){i.find(".js-modal-content").append(n.render(s.html(),r))}})},x=function(e){e.stopPropagation(),console.info("showDiscountPopup");var t=o(this),r={},i=o(m.html()).appendTo(a),d=t.data("modal-title"),l=t.data("modal-position");i.find(".js-modal-title").text(d),i.addClass(l),i.lightbox_me({onLoad:function(){i.find(".js-modal-content").append(n.render(u.html(),r))},centered:!1}),e.preventDefault()},b=function(n){n.stopPropagation();var a=o(n.currentTarget),r=a.find(".js-order-delivery-map-link-text"),d=o(a.data("containerSelector")),l=o(".js-order-points-container"),p=a.data("mapData"),s="show-map";l.toggleClass(s),r.text(o(".js-order-points-containet-type:hidden").data("order-points-type")),e(["module/yandexmaps"],function(e){e.initMap(i,p,f).done(function(n){var r,l=o.parseJSON(o(a.data("dataSelector")).html()).points;n.setCenter([p.center.lat,p.center.lng],p.zoom),n.balloon.close(),n.geoObjects.removeAll(),n.container.fitToViewport(),d.append(i),t.each(l,function(o){try{r=new e.ymaps.Placemark([o.lat,o.lng],{point:o,hintContent:o.name},{iconLayout:"default#image",iconImageHref:"/img/markers/"+o.icon,iconImageSize:[28,39],iconImageOffset:[-14,-39],zIndex:"shops"==o.group.token?1e3:0}),n.geoObjects.add(r)}catch(t){console.error(t)}})})})};a.on("click",".js-order-delivery-form-control",v),a.on("click",".js-order-delivery-pointPopup-link",y),a.on("click",".js-order-delivery-addressPopup-link",j),a.on("click",".js-order-delivery-discountPopup-link",x),a.on("click",".js-order-delivery-map-link",b),a.on("click",".js-order-delivery-celendar-link",k),a.on("change",".js-order-delivery-points-filter-params-list input",g)});
=======
define(["require","jquery","underscore","mustache","module/util","module/config","jquery.maskedinput","module/order/user.form","module/order/common","module/order/toggle"],function(e,t,o,n,a,r){var d=t("body"),i=t(".js-order-delivery-form"),l=t("#yandexMap"),s=t("#yandexMap-container"),p=t("#tpl-order-delivery-marker-balloon"),c=t("#tpl-order-delivery-point-popup"),u=t("#tpl-order-delivery-calendar"),m=t("#tpl-order-delivery-address-popup"),f=t("#tpl-modalWindow"),v=t("#tpl-order-delivery-discount-popup"),h=function(e){e.geoObjects.events.remove("click"),e.geoObjects.events.add("click",function(t){var o=t.get("target");console.info("placemark",o,o.properties.get("point")),e.balloon.open(t.get("coords"),n.render(p.html(),o.properties.get("point")))})},y=function(o){var n=o.find(".js-smartAddress-form");e(["jquery.kladr"],function(){t.kladr.setDefault({token:r.kladr.token,key:r.kladr.key,type:t.kladr.type.street,parentType:t.kladr.type.city,parentId:r.kladr.city.id,parentInput:".js-smartAddress-form",verify:!0,select:function(){},check:function(e){t(this)},checkBefore:function(){var e=t(this);return t.trim(e.val())?void 0:!1}}),n.find(".js-smartAddress-input").each(function(e,o){var n=t(o);n.kladr("type",n.data("kladrType"))})})},g=function(e){e.stopPropagation();var o=t(e.currentTarget);o.data("value")&&t.ajax({url:i.attr("action"),data:o.data("value"),type:"post",timeout:3e4}).done(function(e){t(i.data("containerSelector")).html(e)}).always(function(){console.info("unblock screen")}),e.preventDefault()},k=function(e){var o=t(".js-delivery-type").data("data-selector"),a=t.parseJSON(t(o).html()),r=a.points,d={};d.points=[];for(var i=0;i<e.length;i++)for(var l=0;l<r.length;l++)(e[i]==r[l].group.value||e[i]==r[l].cost.name||e[i]==r[l].date.value)&&d.points.push(r[l]);t(".js-order-points-container-type-points").html(n.render(c.html(),d)),console.log(d),console.log(a)},j=function(e){e.stopPropagation();var o=t(".js-order-delivery-points-filter-params-list"),n=o.find("input"),a=[];n.each(function(){1==t(this).prop("checked")&&a.push(this.value)}),k(a),console.log(a)},x=function(o){o.stopPropagation();var a=t(this),r=t.parseJSON(t(a.data("dataSelector")).html()),i=t(f.html()).appendTo(d),p=a.data("modal-title"),u=a.data("modal-position");i.find(".js-modal-title").text(p),i.addClass(u),i.lightbox_me({onLoad:function(){i.find(".js-modal-content").append(n.render(c.html(),r,c.data("partial"))),d.css({overflow:"hidden"})},beforeClose:function(){s.append(l),d.css({overflow:"auto"})},centered:!1}),o.preventDefault(),setTimeout(function(){e(["module/yandexmaps"],function(){})},2500)},b=function(){var o=t(this),a=t(f.html()).appendTo(d),r=o.data("modal-title"),i=o.data("modal-position"),l={};e(["jquery.kladr"],function(){}),a.find(".js-modal-title").text(r),a.addClass(i),a.lightbox_me({onLoad:function(){a.find(".js-modal-content").append(n.render(m.html(),l)),y(a)},modalCSS:{top:"60px"}})},S=function(e){e.stopPropagation();var o=t(this),a=t.parseJSON(t(o.data("dataSelector")).html()),r=t(f.html()).appendTo(d),i=o.data("modal-title"),l=o.data("modal-position");r.find(".js-modal-title").text(i),r.addClass(l),r.lightbox_me({onLoad:function(){r.find(".js-modal-content").append(n.render(u.html(),a))}})},P=function(e){e.stopPropagation(),console.info("showDiscountPopup");var o=t(this),a={},r=t(f.html()).appendTo(d),i=o.data("modal-title"),l=o.data("modal-position");r.find(".js-modal-title").text(i),r.addClass(l),r.lightbox_me({onLoad:function(){r.find(".js-modal-content").append(n.render(v.html(),a))},centered:!1}),e.preventDefault()},T=function(n){n.stopPropagation();var a=t(n.currentTarget),r=a.find(".js-order-delivery-map-link-text"),d=t(a.data("containerSelector")),i=t(".js-order-points-container"),s=a.data("mapData"),p="show-map";i.toggleClass(p),r.text(t(".js-order-points-containet-type:hidden").data("order-points-type")),e(["module/yandexmaps"],function(e){e.initMap(l,s,h).done(function(n){var r,i=t.parseJSON(t(a.data("dataSelector")).html()).points;n.setCenter([s.center.lat,s.center.lng],s.zoom),n.balloon.close(),n.geoObjects.removeAll(),n.container.fitToViewport(),d.append(l),o.each(i,function(t){try{r=new e.ymaps.Placemark([t.lat,t.lng],{point:t,hintContent:t.name},{iconLayout:"default#image",iconImageHref:"/img/markers/"+t.icon,iconImageSize:[28,39],iconImageOffset:[-14,-39],zIndex:"shops"==t.group.token?1e3:0}),n.geoObjects.add(r)}catch(o){console.error(o)}})})})};d.on("click",".js-order-delivery-form-control",g),d.on("click",".js-order-delivery-pointPopup-link",x),d.on("click",".js-order-delivery-addressPopup-link",b),d.on("click",".js-order-delivery-discountPopup-link",P),d.on("click",".js-order-delivery-map-link",T),d.on("click",".js-order-delivery-celendar-link",S),d.on("change",".js-order-delivery-points-filter-params-list input",j)});
>>>>>>> 2aade8817255dbbd9e1f90787b2f071309bdbcaf
