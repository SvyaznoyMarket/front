define(["require","jquery","underscore","mustache","module/util","jquery.maskedinput","module/order/user.form","module/order/common","module/order/toggle","jquery.modal"],function(e,o,t,a){var n=o("body"),r=o(".js-order-delivery-form"),i=o("#yandexMap"),d=function(e){e.stopPropagation();var t=o(this);o.ajax({url:r.attr("action"),data:t.data("value"),type:"post",timeout:3e4}).done(function(e){o(r.data("containerSelector")).html(e)}).always(function(){console.info("unblock screen")}),e.preventDefault()},l=function(t){t.stopPropagation(),o(this).modal();var n=o(this),r=o(".js-modal-content"),i=o("#tpl-order-delivery-point-popup"),d=o.parseJSON(o(n.data("dataSelector")).html());r.append(a.render(i.html(),d)),t.preventDefault(),e(["yandexmaps"],function(){})},c=function(e){e.stopPropagation(),o(this).modal();var t=o(this),n=o(".js-modal-content"),r=o("#tpl-order-delivery-calendar"),i=o.parseJSON(o(t.data("dataSelector")).html());n.append(a.render(r.html(),i))},p=function(a){a.stopPropagation();var n=o(a.currentTarget),r=o(n.data("containerSelector")),d=n.data("mapData");e(["module/yandexmaps"],function(e){e.initMap(i,d).done(function(a){var l,c=o.parseJSON(o(n.data("dataSelector")).html()).points;a.setCenter([d.center.lat,d.center.lng],d.zoom),a.geoObjects.removeAll(),a.container.fitToViewport(),t.each(c,function(o){try{l=new e.ymaps.Placemark([o.lat,o.lng],{hintContent:o.name},{iconLayout:"default#image",iconImageHref:"/img/markers/"+o.icon,iconImageSize:[28,39],iconImageOffset:[-14,-39],zIndex:"shops"==o.group.token?1e3:0}),a.geoObjects.add(l)}catch(t){console.error(t)}}),r.append(i.show())})})};n.on("click",".js-order-delivery-form-control",d),n.on("click",".js-order-delivery-pointPopup-link",l),n.on("click",".js-order-delivery-map-link",p),n.on("click",".js-order-delivery-celendar-link",c)});