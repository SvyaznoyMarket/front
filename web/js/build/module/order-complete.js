define(["require","jquery","underscore","mustache","module/util","module/config","jquery.ui","jquery.maskedinput","module/order/user.form","module/order/common"],function(o,e,n,t){var a=e("body"),r=e("#tpl-order-complete-onlinePayment-popup"),l=e("#tpl-modalWindow"),i=function(o){var n=e(this),i=e(l.html()).appendTo(a),d=n.data("modal-title"),c=n.data("modal-position"),u=e.parseJSON(e(n.data("storageSelector")).html());console.info(u),o.stopPropagation(),i.find(".js-modal-title").text(d),i.addClass(c),i.lightbox_me({fullScreen:!0,modal:!1,onLoad:function(){i.find(".js-modal-content").append(t.render(r.html(),u))},beforeClose:function(){}})},d=function(o){var n=e(this),t=e(n.data("containerSelector")),a=t.data("url"),r=n.data("value");o.stopPropagation(),console.info(n,t),e.ajax({url:a,data:r,type:"post",timeout:4e4}).done(function(o){t.html(o.form)}).always(function(){console.info("unblock screen")}).error(function(o){var n,t;o&&302===o.status&&(n=e.parseJSON(o.responseText)||{},t=n.redirect||"/cart",window.location.href=t)})};a.on("click",".js-order-delivery-onlinePayment-link",i),a.on("click",".js-order-delivery-onlinePayment-radio",d)});