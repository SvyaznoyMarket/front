define(["require","jquery","underscore","mustache","module/util","module/config","module/form-validator","module/order/analytics.google","jquery.ui","jquery.maskedinput"],function(o,e,t,n,r,a,i,d){var s=e("body"),c=e("#tpl-order-complete-onlinePayment-popup"),l=e("#tpl-modalWindow"),u=function(o){var t=e(this),r=e(l.html()).appendTo(s),a=t.data("modal-title"),i=t.data("modal-position"),d=e.parseJSON(e(t.data("storageSelector")).html());console.info(d),o.stopPropagation(),r.find(".js-modal-title").text(a),r.addClass(i),r.lightbox_me({fullScreen:!0,modal:!1,onLoad:function(){r.find(".js-modal-content").append(n.render(c.html(),d))},beforeClose:function(){}})},m=function(o){function t(o){o.closest(".js-order-payment-container").find(".js-order-payment-hint").addClass("error").text("Ошибка. Попробуйте обновить страницу и выполнить действие снова.")}var n=e(this),r=e(n.data("containerSelector")),a=r.data("url"),i=n.data("value");o.stopPropagation(),e.ajax({url:a,data:i,type:"post",timeout:4e4}).done(function(o){r.html(o.form);var n=r.find("form");n.attr("data-require-validation")&&n.on("submit",function(o,r){r||(o.preventDefault(),e.ajax({type:"POST",url:"/ajax/order/payment/start",data:{paymentMethodId:n.attr("data-payment-method-id"),orderAccessToken:n.attr("data-order-access-token"),orderAction:n.attr("data-order-action")}}).success(function(o){o&&o.success?n.trigger("submit",[!0]):t(n)}).error(function(){t(n)}))})}).always(function(){console.info("unblock screen")}).error(function(o,t,n){var r,a;o&&302===o.status&&(r=e.parseJSON(o.responseText)||{},a=r.redirect||"/cart",window.location.href=a)})};s.on("click",".js-order-complete-onlinePayment-link",u),s.on("click",".js-order-complete-onlinePayment-radio",m),e(".js-moreLink").on("click",function(o){var t=e(this);t.siblings().show(),t.hide(),o.preventDefault()});try{!function(){var o=e(".js-order-complete").data("orders");o&&(r.sendOrdersToGoogleAnalytics(o),r.partner.flocktory.send({action:"postcheckout",orders:o,spot:"mob"}))}(),d.push(["16 Вход_Оплата_ОБЯЗАТЕЛЬНО"]),s.on("click",".js-order-complete-onlinePayment-link",function(o){d.push(["17 Оплатить_онлайн_вход_Оплата"])}),s.on("click",".js-order-complete-onlinePayment-radio",function(o){var t=e(this);"5"===t.val()?d.push(["17_1 Оплатить_онлайн_Оплата","Онлайн-оплата"]):"8"===t.val()&&d.push(["17_1 Оплатить_онлайн_Оплата","Psb"])})}catch(o){console.error(o)}});