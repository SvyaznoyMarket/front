define([],function(){var t={formatCurrency:function(t){return t=String(t),t=t.replace(",","."),t=t.replace(/\s/g,""),t=String(Number(t).toFixed(2)),t=t.split("."),t[0].length>=5&&(t[0]=t[0].replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")),0==t[1]&&(t=t.slice(0,1)),t.join(".")},trackGoogleAnalyticsTransaction:function(t){function a(t){if(t=$.extend(!0,{},t),!t.transaction.id)throw"Некорректный ID транзакции";if(!t.transaction.total)throw"Некорректная сумма заказа";return t.transaction.id=t.transaction.id?t.transaction.id+"":"",t.transaction.affiliation=t.transaction.affiliation?t.transaction.affiliation+"":"",t.transaction.total=t.transaction.total?t.transaction.total+"":"",t.transaction.tax=t.transaction.tax?t.transaction.tax+"":"0",t.transaction.shipping=t.transaction.shipping?t.transaction.shipping+"":"0",t.transaction.city=t.transaction.city?t.transaction.city+"":"",t.products=$.map(t.products,function(t){if(!t.name)throw"Некорректное название товара";if(!t.price)throw"Некорректная цена товара";if(!t.quantity)throw"Некорректное количество товара";return{sku:t.sku?t.sku+"":"",name:t.name?t.name+"":"",category:t.category?t.category+"":"",price:t.price?t.price+"":"",quantity:t.quantity?t.quantity+"":""}}),t}function n(t){"object"==typeof _gaq?(_gaq.push(["_addTrans",t.transaction.id,t.transaction.affiliation,t.transaction.total,t.transaction.tax,t.transaction.shipping,t.transaction.city]),$.each(t.products,function(a,n){_gaq.push(["_addItem",t.transaction.id,n.sku,n.name,n.category,n.price,n.quantity])}),_gaq.push(["_trackTrans"])):console.warn("No Classic Google Analytics object found")}function i(t){"function"==typeof ga&&0!=ga.getAll().length?(ga("require","ecommerce","ecommerce.js"),ga("ecommerce:addTransaction",{id:t.transaction.id,affiliation:t.transaction.affiliation,revenue:t.transaction.total,shipping:t.transaction.shipping,tax:t.transaction.tax}),$.each(t.products,function(a,n){ga("ecommerce:addItem",{id:t.transaction.id,name:n.name,sku:n.sku,category:n.category,price:n.price,quantity:n.quantity})}),ga("ecommerce:send")):console.warn("No Universal Google Analytics function found")}try{t=a(t),n(t),i(t)}catch(o){console.error("[Google Analytics Ecommerce] %s",o)}},sendOrdersToGoogleAnalytics:function(a){$.each(a,function(a,n){t.trackGoogleAnalyticsTransaction({transaction:{id:n.number,affiliation:n.isPartner?"Партнер":"Enter",total:n.paySum,shipping:n.delivery.price,city:n.region.name},products:$.map(n.products,function(t){return{id:t.id,name:t.name,sku:t.article,category:t.categories.length?t.categories[0].name+" - "+t.categories[t.categories.length-1].name:"",price:t.price,quantity:t.quantity}})})})}};return t});