define([],function(){var t={formatCurrency:function(t){return t=String(t),t=t.replace(",","."),t=t.replace(/\s/g,""),t=String(Number(t).toFixed(2)),t=t.split("."),t[0].length>=5&&(t[0]=t[0].replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")),0==t[1]&&(t=t.slice(0,1)),t.join(".")},trackGoogleAnalyticsTransaction:function(t){function n(t){if(t=$.extend(!0,{},t),!t.transaction.id)throw"Некорректный ID транзакции";if(!t.transaction.total)throw"Некорректная сумма заказа";return t.transaction.id=t.transaction.id?t.transaction.id+"":"",t.transaction.affiliation=t.transaction.affiliation?t.transaction.affiliation+"":"",t.transaction.total=t.transaction.total?t.transaction.total+"":"",t.transaction.tax=t.transaction.tax?t.transaction.tax+"":"0",t.transaction.shipping=t.transaction.shipping?t.transaction.shipping+"":"0",t.transaction.city=t.transaction.city?t.transaction.city+"":"",t.products=$.map(t.products,function(t){if(!t.name)throw"Некорректное название товара";if(!t.price)throw"Некорректная цена товара";if(!t.quantity)throw"Некорректное количество товара";return{sku:t.sku?t.sku+"":"",name:t.name?t.name+"":"",category:t.category?t.category+"":"",price:t.price?t.price+"":"",quantity:t.quantity?t.quantity+"":""}}),t}function a(t){"object"==typeof _gaq?(_gaq.push(["_addTrans",t.transaction.id,t.transaction.affiliation,t.transaction.total,t.transaction.tax,t.transaction.shipping,t.transaction.city]),$.each(t.products,function(n,a){_gaq.push(["_addItem",t.transaction.id,a.sku,a.name,a.category,a.price,a.quantity])}),_gaq.push(["_trackTrans"])):console.warn("No Classic Google Analytics object found")}function i(t){"function"==typeof ga&&0!=ga.getAll().length?(ga("require","ecommerce","ecommerce.js"),ga("ecommerce:addTransaction",{id:t.transaction.id,affiliation:t.transaction.affiliation,revenue:t.transaction.total,shipping:t.transaction.shipping,tax:t.transaction.tax}),$.each(t.products,function(n,a){ga("ecommerce:addItem",{id:t.transaction.id,name:a.name,sku:a.sku,category:a.category,price:a.price,quantity:a.quantity})}),ga("ecommerce:send")):console.warn("No Universal Google Analytics function found")}try{t=n(t),a(t),i(t)}catch(e){console.error("[Google Analytics Ecommerce] %s",e)}},trackGoogleAnalyticsEvent:function(t){"send"==t[0]&&"event"==t[1]&&(console.log("ga event",t),"undefined"!=typeof t[2]&&(t[2]=String(t[2])),"undefined"!=typeof t[3]&&(t[3]=String(t[3])),"undefined"!=typeof t[4]&&(t[4]=String(t[4])),"undefined"!=typeof t[5]&&(t[5]=Number(t[5])),"undefined"!=typeof ga&&ga.apply(ga,t),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent"].concat(t.slice(2))))},sendOrdersToGoogleAnalytics:function(n){$.each(n,function(n,a){t.trackGoogleAnalyticsTransaction({transaction:{id:a.number,affiliation:a.isPartner?"Партнер":"Enter",total:a.paySum,shipping:a.delivery.price,city:a.region.name},products:$.map(a.products,function(t){return{id:t.id,name:t.name,sku:t.article,category:t.categories.length?t.categories[0].name+" - "+t.categories[t.categories.length-1].name:"",price:t.price,quantity:t.quantity}})})})}};return t});